!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@angular/core"),require("rxjs/Observable"),require("rxjs/Subject"),require("rxjs/add/observable/of"),require("rxjs/add/observable/from"),require("rxjs/add/operator/mergeMap"),require("rxjs/add/operator/map")):"function"==typeof define&&define.amd?define("ngx-uploader",["@angular/core","rxjs/Observable","rxjs/Subject","rxjs/add/observable/of","rxjs/add/observable/from","rxjs/add/operator/mergeMap","rxjs/add/operator/map"],t):"object"==typeof exports?exports["ngx-uploader"]=t(require("@angular/core"),require("rxjs/Observable"),require("rxjs/Subject"),require("rxjs/add/observable/of"),require("rxjs/add/observable/from"),require("rxjs/add/operator/mergeMap"),require("rxjs/add/operator/map")):e["ngx-uploader"]=t(e["@angular/core"],e["rxjs/Observable"],e["rxjs/Subject"],e["rxjs/add/observable/of"],e["rxjs/add/observable/from"],e["rxjs/add/operator/mergeMap"],e["rxjs/add/operator/map"])}(this,function(e,t,n,r,o,i,u){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=4)}([function(t,n){t.exports=e},function(e,t,n){"use strict";function r(e){if(0===e)return"0 Byte";var t=["Bytes","KB","MB","GB","TB","PB"],n=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,n)).toFixed(2))+" "+t[n]}n.d(t,"b",function(){return o}),t.c=r,n.d(t,"a",function(){return l});var o,i=n(0),u=(n.n(i),n(6)),a=(n.n(u),n(7)),s=(n.n(a),n(8)),p=(n.n(s),n(9)),d=(n.n(p),n(10)),c=(n.n(d),n(11));n.n(c);!function(e){e[e.Queue=0]="Queue",e[e.Uploading=1]="Uploading",e[e.Done=2]="Done",e[e.Cancelled=3]="Cancelled"}(o||(o={}));var l=function(){function e(e){void 0===e&&(e=Number.POSITIVE_INFINITY);var t=this;this.queue=[],this.serviceEvents=new i.EventEmitter,this.uploadScheduler=new a.Subject,this.subs=[],this.uploadScheduler.mergeMap(function(e){return t.startUpload(e)},e).subscribe(function(e){return t.serviceEvents.emit(e)})}return e.prototype.handleFiles=function(e){var t=this;(n=this.queue).push.apply(n,[].map.call(e,function(e,n){var i={fileIndex:n,id:t.generateId(),name:e.name,size:e.size,type:e.type,form:new FormData,progress:{status:o.Queue,data:{percentage:0,speed:0,speedHuman:r(0)+"/s",startTime:null,endTime:null,eta:null,etaHuman:null}},lastModifiedDate:e.lastModifiedDate,sub:void 0,nativeFile:e};return t.serviceEvents.emit({type:"addedToQueue",file:i}),i})),this.serviceEvents.emit({type:"allAddedToQueue"});var n},e.prototype.initInputEvents=function(e){var t=this;e.subscribe(function(e){switch(e.type){case"uploadFile":var n=t.queue.findIndex(function(t){return t===e.file});-1!==n&&e.file&&t.uploadScheduler.next({file:t.queue[n],event:e});break;case"uploadAll":t.queue.filter(function(e){return e.progress.status===o.Queue}).forEach(function(n){return t.uploadScheduler.next({file:n,event:e})});break;case"cancel":var r=e.id||null;if(!r)return;var i=t.subs.findIndex(function(e){return e.id===r});if(-1!==i&&t.subs[i].sub){t.subs[i].sub.unsubscribe();var u=t.queue.findIndex(function(e){return e.id===r});-1!==u&&(t.queue[u].progress.status=o.Cancelled,t.serviceEvents.emit({type:"cancelled",file:t.queue[u]}))}break;case"cancelAll":t.subs.forEach(function(e){e.sub&&e.sub.unsubscribe();var n=t.queue.find(function(t){return t.id===e.id});n&&(n.progress.status=o.Cancelled,t.serviceEvents.emit({type:"cancelled",file:n}))});break;case"remove":if(!e.id)return;var a=t.queue.findIndex(function(t){return t.id===e.id});if(-1!==a){var s=t.queue[a];t.queue.splice(a,1),t.serviceEvents.emit({type:"removed",file:s})}break;case"removeAll":t.queue.length&&(t.queue=[],t.serviceEvents.emit({type:"removedAll"}))}})},e.prototype.startUpload=function(e){var t=this;return new u.Observable(function(n){var r=t.uploadFile(e.file,e.event).subscribe(function(e){n.next(e)},function(e){n.error(e),n.complete()},function(){n.complete()});t.subs.push({id:e.file.id,sub:r})})},e.prototype.uploadFile=function(e,t){var n=this;return new u.Observable(function(i){var u=t.url||"",a=t.method||"POST",s=t.data||{},p=t.headers||{},d=new FileReader,c=new XMLHttpRequest,l=(new Date).getTime(),f=e.progress.data&&e.progress.data.startTime||l,v=0,b=null;c.upload.addEventListener("progress",function(t){if(t.lengthComputable){var u=Math.round(100*t.loaded/t.total),a=(new Date).getTime()-l;v=Math.round(t.loaded/a*1e3),f=e.progress.data&&e.progress.data.startTime||(new Date).getTime(),b=Math.ceil((t.total-t.loaded)/v),e.progress={status:o.Uploading,data:{percentage:u,speed:v,speedHuman:r(v)+"/s",startTime:f,endTime:null,eta:b,etaHuman:n.secondsToHuman(b)}},i.next({type:"uploading",file:e})}},!1),c.upload.addEventListener("error",function(e){i.error(e),i.complete()}),c.onreadystatechange=function(){if(c.readyState===XMLHttpRequest.DONE){var t=Math.round(e.size/((new Date).getTime()-f)*1e3);e.progress={status:o.Done,data:{percentage:100,speed:t,speedHuman:r(t)+"/s",startTime:f,endTime:(new Date).getTime(),eta:b,etaHuman:n.secondsToHuman(b||0)}},e.responseStatus=c.status;try{e.response=JSON.parse(c.response)}catch(t){e.response=c.response}i.next({type:"done",file:e}),i.complete()}},c.open(a,u,!0),c.withCredentials=!!t.withCredentials;try{var h=e.nativeFile,m=n.queue.findIndex(function(e){return e.nativeFile===h});n.queue[m].progress.status===o.Cancelled&&i.complete(),e.form.append(t.fieldName||"file",h,h.name),Object.keys(s).forEach(function(t){return e.form.append(t,s[t])}),Object.keys(p).forEach(function(e){return c.setRequestHeader(e,p[e])}),n.serviceEvents.emit({type:"start",file:e}),c.send(e.form)}catch(e){i.complete()}return function(){c.abort(),d.abort()}})},e.prototype.secondsToHuman=function(e){return new Date(1e3*e).toISOString().substr(11,8)},e.prototype.generateId=function(){return Math.random().toString(36).substring(7)},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(0),o=(n.n(r),n(1)),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,u=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(u=(i<3?o(u):i>3?o(t,n,u):o(t,n))||u);return i>3&&u&&Object.defineProperty(t,n,u),u},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.elementRef=e,this.stopEvent=function(e){e.stopPropagation(),e.preventDefault()},this.uploadOutput=new r.EventEmitter}return e.prototype.ngOnInit=function(){var e=this,t=this.options&&this.options.concurrency||Number.POSITIVE_INFINITY;this.upload=new o.a(t),this.el=this.elementRef.nativeElement,this.upload.serviceEvents.subscribe(function(t){e.uploadOutput.emit(t)}),this.uploadInput instanceof r.EventEmitter&&this.upload.initInputEvents(this.uploadInput),this.el.addEventListener("drop",this.stopEvent,!1),this.el.addEventListener("dragenter",this.stopEvent,!1),this.el.addEventListener("dragover",this.stopEvent,!1)},e.prototype.ngOnDestroy=function(){this.uploadInput&&this.uploadInput.unsubscribe()},e.prototype.onDrop=function(e){e.stopPropagation(),e.preventDefault();var t={type:"drop"};this.uploadOutput.emit(t),this.upload.handleFiles(e.dataTransfer.files)},e.prototype.onDragOver=function(e){if(e){var t={type:"dragOver"};this.uploadOutput.emit(t)}},e.prototype.onDragLeave=function(e){if(e){var t={type:"dragOut"};this.uploadOutput.emit(t)}},i([Object(r.Input)(),u("design:type",Object)],e.prototype,"options",void 0),i([Object(r.Input)(),u("design:type",r.EventEmitter)],e.prototype,"uploadInput",void 0),i([Object(r.Output)(),u("design:type",r.EventEmitter)],e.prototype,"uploadOutput",void 0),i([Object(r.HostListener)("drop",["$event"]),u("design:type",Function),u("design:paramtypes",[Object]),u("design:returntype",void 0)],e.prototype,"onDrop",null),i([Object(r.HostListener)("dragover",["$event"]),u("design:type",Function),u("design:paramtypes",[Event]),u("design:returntype",void 0)],e.prototype,"onDragOver",null),i([Object(r.HostListener)("dragleave",["$event"]),u("design:type",Function),u("design:paramtypes",[Event]),u("design:returntype",void 0)],e.prototype,"onDragLeave",null),e=i([Object(r.Directive)({selector:"[ngFileDrop]"}),u("design:paramtypes",[r.ElementRef])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(0),o=(n.n(r),n(1)),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,u=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(u=(i<3?o(u):i>3?o(t,n,u):o(t,n))||u);return i>3&&u&&Object.defineProperty(t,n,u),u},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){var t=this;this.elementRef=e,this.fileListener=function(){t.el.files&&t.upload.handleFiles(t.el.files)},this.uploadOutput=new r.EventEmitter}return e.prototype.ngOnInit=function(){var e=this,t=this.options&&this.options.concurrency||Number.POSITIVE_INFINITY;this.upload=new o.a(t),this.el=this.elementRef.nativeElement,this.el.addEventListener("change",this.fileListener,!1),this.upload.serviceEvents.subscribe(function(t){e.uploadOutput.emit(t)}),this.uploadInput instanceof r.EventEmitter&&this.upload.initInputEvents(this.uploadInput)},e.prototype.ngOnDestroy=function(){this.el.removeEventListener("change",this.fileListener,!1),this.uploadInput&&this.uploadInput.unsubscribe()},i([Object(r.Input)(),u("design:type",Object)],e.prototype,"options",void 0),i([Object(r.Input)(),u("design:type",r.EventEmitter)],e.prototype,"uploadInput",void 0),i([Object(r.Output)(),u("design:type",r.EventEmitter)],e.prototype,"uploadOutput",void 0),e=i([Object(r.Directive)({selector:"[ngFileSelect]"}),u("design:paramtypes",[r.ElementRef])],e)}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5);n.d(t,"NgUploaderModule",function(){return r.a});var o=n(1);n.d(t,"UploadStatus",function(){return o.b}),n.d(t,"humanizeBytes",function(){return o.c}),n.d(t,"NgUploaderService",function(){return o.a});var i=n(3);n.d(t,"NgFileSelectDirective",function(){return i.a});var u=n(2);n.d(t,"NgFileDropDirective",function(){return u.a})},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(0),o=(n.n(r),n(2)),i=n(3),u=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,u=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(u=(i<3?o(u):i>3?o(t,n,u):o(t,n))||u);return i>3&&u&&Object.defineProperty(t,n,u),u},a=function(){function e(){}return e=u([Object(r.NgModule)({declarations:[i.a,o.a],exports:[i.a,o.a]})],e)}()},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t){e.exports=o},function(e,t){e.exports=i},function(e,t){e.exports=u}])});
//# sourceMappingURL=ngx-uploader.umd.js.map